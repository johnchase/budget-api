dist: trusty
jobs:
  include:
  - stage: test
    language: python
    name: Backend Tests
    python:
    - 3.6
    env:
    - DJANGO=2.1.7
    - DB=postgresql
    - DJANGO_SETTINGS_MODULE=config.settings.production
    before_script:
    - psql -U postgres -tc "SELECT 1 FROM pg_database WHERE datname = 'travis'" |
      grep -q 1 || psql -U postgres -c "CREATE DATABASE travis;"
    install:
    - make install
    - pip install coveralls pyyaml flake8-docstrings
    script:
    - make build
    - make test
    after_success:
    - coveralls
    cache:
      directories:
      - "$HOME/.cache/pip"
deploy:
  provider: elasticbeanstalk
  access_key_id: KIA6QW6FCJ6ZUF2XSFJ
  secret_access_key:
    secure: ggmdt9YCRn7qGIxtAEEZsXWH7C39swHRzgG4zqVQDaqmZgibSSsZC4hBEfcCsH9VqyiWXA28oNLzMYWSXaf1wUcFtZDS8074OH/bERsRlMjcDRnfyuK0nEongid8gZaYUbsjdSsXzxnvw5ScckBRsB9m1prNT4wsVpZhoQfGfTsIEhaJQ+cVI/AVmLWC//kX0RAZN+O49lf3XKTRf2DNc50F43WlKBlAAGDL9UpRzCYj42gfnhvzN4SM9Uakq/Dtik01JHAZBpInZ/qdC0LT5N9QPeve3CmH23Uu7/6VJLSus79Q3U9hHNv9L2mxKx08i+YVJUOFpZ4BCnlV1wE/hfDMiZyH6QyUeTQc0lHqWK11dHvNhFhBF/0chSlS4V79OX6eLa1dcxf/v1zh+l7RcAl8gi0xGF5c6fPIpaV7o8QDl+4eX6iDF358lV01qxrzuaR0WFIaXGIXsvkuFmzWRVXIzSrXwp9R37T7gS7MYisX+DbKc3xwMrosRY0PlUv9skjsz/VFg93s/QZLFho7YwOhi7QJvt7qZZdV3RjzikzFh4NgTRNcGVos3d5BftFUUy7PUIySzB7rEFdK+kgW7Fb/DPLYRhDqkE8XseSr82TLWubE70VnWGa8u0pU+LS5YIxh4zQQw8RKxay0nHz5traY0mPZNvu/cjufijt8Rfw=
  region: us-west-1
  app: budget
  env: BudgetApi-env
  bucket: elasticbeanstalk-us-west-1-997972054653
  on:
    repo: johnchase/budget-api
    branch: aws-deploy
